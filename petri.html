<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio - Selecci√≥n de Muestras</title>
    <link rel="stylesheet" href="Hoja de estilo corrector.css">

    <style>
        /* --- ESTILOS GENERALES --- */
        body {
            background-color: #f0f4f8;
            background-image: url('Assets/fondo_mesa.jpg');
            background-size: cover;
            font-family: sans-serif;
            overflow: hidden;
            height: 100vh;
            margin: 0;
        }

        /* CAMBIO 1: SE RETIRARON LOS BORDES ROJOS DE PROTOTIPADO */
        .debug {
            border: none !important;
            background-color: transparent !important;
        }

        #mesa-trabajo {
            position: relative;
            width: 100%;
            height: 100vh;
            /* Quitamos el flex center para poder mover el grid libremente */
            display: block; 
        }

        /* --- EFECTO DE OPACIDAD AL PASAR EL CURSOR (GENERAL) --- */
        .objeto-interactivo {
            opacity: 0; /* Invisible por defecto */
            transition: opacity 0.4s ease, transform 0.2s ease;
            cursor: pointer;
        }
        
        .objeto-interactivo:hover {
            opacity: 1; /* Aparece al pasar el mouse */
            transform: scale(1.03);
        }

        /* --- MECHERO (IZQUIERDA) --- */
        #mechero-container {
            position: absolute;
            left: 6.5%;
            top: 18%;
            width: 15.4%;
            text-align: center;
        }

        /* El PNG del mechero SOLO aparece con hover */
        #mechero-img {
            width: 100%;
            opacity: 0;
            transition: opacity 0.4s ease, transform 0.2s ease;
            cursor: pointer;
        }
        #mechero-container:hover #mechero-img {
            opacity: 1;
            transform: scale(1.03);
        }

        /* La llama NO depende del hover: solo del estado (clase .activo) */
        .fuego {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
            filter: drop-shadow(0 0 10px orange);
            font-size: 2rem;
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 5;
        }
        .fuego.activo { opacity: 1 !important; }

        /* --- CAJAS PETRI (CENTRO - DERECHA) --- */
        /* CAMBIO 3: AJUSTE DE POSICIONAMIENTO */
        #grid-petri {
            position: absolute;
            /* Centrado vertical */
            top: 48%;
            
            /* AJUSTE HORIZONTAL: 
               50% es el centro exacto. 
               Puse 55% para moverlo a la derecha seg√∫n tu imagen.
               Sube este n√∫mero si necesitas moverlo m√°s a la derecha. */
            left: 54%; 
            
            /* Esto centra el grid sobre su propio punto de anclaje */
            transform: translate(-50%, -50%);

            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(3, 1fr);
            row-gap: -20px;
            column-gap: 110px;
            
            /* Eliminamos m√°rgenes viejos para usar posici√≥n absoluta pura */
            margin: 0; 
        }

        .caja-petri {
            width: 205px;
            height: 205px;
            background-image: url('Assets/petri.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center; 
            border-radius: 50%;
        }

        /* CAMBIO 2: GLOW BLANCO AL PASAR EL MOUSE SOBRE LAS CAJAS */
        .caja-petri:hover {
            /* Mantenemos la opacidad y escala del padre, a√±adimos el brillo */
            filter: drop-shadow(0 0 30px rgba(21, 21, 21, 0.9));
            opacity: 1; /* Aseguramos que sea visible */
            transform: scale(1.05);
        }

        /* --- ASA BACTERIOL√ìGICA (DERECHA) --- */
        #asa-container {
            position: absolute;
            top: 28%;
            right: 10%;
            height: 520px;
            width: 70px;
        }
        #asa-img {
            height: 100%;
        }

        .asa-seleccionada {
            filter: drop-shadow(0 0 15px cyan) !important;
            opacity: 1 !important; /* Se mantiene visible si la tienes en la mano */
        }

        /* --- CURSOR PERSONALIZADO --- */
        body.cursor-asa {
            cursor: url('Assets/asa1.png') 10 10, auto;
        }

        /* --- ALERTAS --- */
        #advertencia {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 0, 0, 0.85);
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            display: none;
            z-index: 100;
            font-weight: bold;
        }

        .boton-volver-flotante {
            position: fixed;
            bottom: 20px;
            left: 20px;
            text-decoration: none;
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 20px;
        }
    </style>
</head>
<body id="cuerpo-pagina">

    <div id="advertencia">‚ö† ¬°Debes encender el mechero para esterilizar el √°rea!</div>

    <div id="mesa-trabajo">

        <div id="mechero-container" class="debug" onclick="toggleMechero()">
            <img src="Assets/mechero1.png" id="mechero-img" alt="Mechero Bunsen">
            <div class="fuego" id="fuego-animacion">üî•</div>
        </div>

        <div id="grid-petri">
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(1)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(2)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(3)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(4)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(5)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(6)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(7)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(8)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(9)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(10)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(11)"></div>
            <div class="caja-petri objeto-interactivo debug" onclick="interactuarPetri(12)"></div>
        </div>

        <div id="asa-container" class="objeto-interactivo debug" onclick="tomarAsa()">
            <img src="Assets/asa1.png" id="asa-img" alt="Asa">
        </div>

    </div>

    <a href="inicio.html" class="boton-volver-flotante">‚¨Ö Volver al Laboratorio</a>

    <script>
        let mecheroEncendido = false;
        let tieneAsaEnMano = false;

        const advertenciaDiv = document.getElementById('advertencia');
        const cuerpo = document.getElementById('cuerpo-pagina');
        const fuego = document.getElementById('fuego-animacion');

        function toggleMechero() {
            mecheroEncendido = !mecheroEncendido;

            if (mecheroEncendido) {
                fuego.classList.add('activo');
            } else {
                fuego.classList.remove('activo');
                if (tieneAsaEnMano) soltarAsa();
            }
        }

        function tomarAsa() {
            if (!mecheroEncendido) {
                mostrarError("¬°No puedes usar herramientas sin esterilizar el √°rea!");
                return;
            }

            tieneAsaEnMano = !tieneAsaEnMano;

            if (tieneAsaEnMano) {
                cuerpo.classList.add('cursor-asa');
                document.getElementById('asa-container').classList.add('asa-seleccionada');
            } else {
                soltarAsa();
            }
        }

        function soltarAsa() {
            tieneAsaEnMano = false;
            cuerpo.classList.remove('cursor-asa');
            document.getElementById('asa-container').classList.remove('asa-seleccionada');
        }

        function interactuarPetri(idCaja) {
            if (!mecheroEncendido) {
                mostrarError("¬°Peligro de contaminaci√≥n! Enciende el mechero.");
                return;
            }

            const modo = tieneAsaEnMano ? "editar" : "ver";
            const urlDestino = `petri2.html?id=${idCaja}&modo=${modo}`;
            guardarYViajar(urlDestino);
        }

        function mostrarError(texto) {
            advertenciaDiv.innerText = texto;
            advertenciaDiv.style.display = 'block';
            setTimeout(() => { advertenciaDiv.style.display = 'none'; }, 3000);
        }

        const NOMBRE_NIVEL = "Mesa de Trabajo";
        const FOTO_NIVEL = "Assets/preview_mesa.jpg";

        function guardarYViajar(url) {
            const datos = {
                nivel: NOMBRE_NIVEL,
                imagen: FOTO_NIVEL,
                url: url,
                fecha: new Date().toLocaleString('es-ES', { hour12: true })
            };

            localStorage.setItem('BacterialFarm_Save1', JSON.stringify(datos));
            window.location.href = url;
        }
    </script>
</body>
</html>